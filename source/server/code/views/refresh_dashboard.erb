<script>
'use strict';
$(() => {

  const $lights = $('#traffic-lights2');
  const $tHeadTr = $('table thead tr', $lights);
  const $tBody = $('table tbody', $lights);

  const id = '<%= @group.id %>';

  cd.refreshDashboard = () => {
    const minuteColumns = cd.minuteColumns.isChecked() ? 'true' : 'false';
    $.getJSON(`/dashboard/heartbeat?id=${id}&minute_columns=${minuteColumns}`, {}, (data) => {
      updateTimeTicks(data.time_ticks);
      updateAvatars(data.avatars);
    });
  };

  const updateTimeTicks = (timeTicks) => {
    $tHeadTr.empty();
    if (cd.minuteColumns.isChecked()) {
      Object.keys(timeTicks).forEach(function(key) {
        const seconds = timeTicks[key];
        const $th = $('<th>');
        if (Number.isInteger(seconds)) {
          $th.append($('<div>', {
            class:'time-tick',
            'data-tip':'TODO'
          }).text(seconds)); // faked
        }
        $tHeadTr.append($th);
      });
      $tHeadTr.append($('<th>')); // to match scroll-marker
    }
  };

  const updateAvatars = (avatars) => {
    // for each avatar...
    //   update avatar-image
    //   update pie-chart
    //   update traffic-light-count
    //   update traffic-lights
  };

});
</script>
